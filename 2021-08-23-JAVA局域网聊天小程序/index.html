
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>JAVAå±€åŸŸç½‘èŠå¤©å°ç¨‹åº | Yao Xiong</title>
        <meta name="author" content="Yao Xiong">
        <meta name="description" content="è«å¬ç©¿æ—æ‰“å¶å£°ï¼Œ ä½•å¦¨åŸå•¸ä¸”å¾è¡Œ">
        <meta name="keywords" content="Yao Xiong Projects">
        <link rel="icon" href="/img/favicon.png">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.2.0/js/all.min.js"></script>
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 5.4.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:2147483647;justify-content:space-between;background:#fff;transition:all 0.3s ease-out;-webkit-user-select:none;-moz-user-select:none;user-select:none"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜(æµè§ˆå™¨é»˜è®¤å¼€å¯)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="showpage" style="display: -not-none">
                    <div id="menushow">
                        <nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">Yao Xiong</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;projects</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menushow" id="phone-menu">
        <div class="curtain" @click="menushow = !menushow" v-show="menushow"></div>
        <div class="title" @click="menushow = !menushow">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;Yao Xiong</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menushow">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">projects</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        <div class="article">
    <div>
        <h1>JAVAå±€åŸŸç½‘èŠå¤©å°ç¨‹åº </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2021/8/23
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
            </span>
            
            <span class="tag">
                
                <a href="/tags/JAVA/" style="color: #00bcd4">
                    JAVA
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/TCP-IP%E5%8D%8F%E8%AE%AE/" style="color: #00bcd4">
                    TCP/IPåè®®
                </a>
            </span>
            
        </span>
        
    </div>
    <div class="content" v-pre>
        <h1 id="ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP-IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡"><a href="#ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP-IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡" class="headerlink" title="ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP/IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡"></a>ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP/IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>é©¬ä¸Šå¼€å­¦äº†ï¼Œé—²ç€æ²¡äº‹åšï¼Œå†³å®šé‡æ–°æ¸©ä¹ JAVAåŠŸè¯¾ï¼Œäºæ˜¯æƒ³èµ·äº†æ›¾ç»è§è¿‡çš„ä¸€ä¸ªé¡¹ç›®ï¼šåŸºäºJAVAè¯­è¨€çš„å±€åŸŸç½‘é€šä¿¡ï¼Œå¯ä»¥å‚è€ƒQQï¼Œå¦‚ä¸‹</p>
<span id="more"></span>

<p><strong>ä¸€çº§èœå•</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823171022391.png" alt="image-20210823171022391"></p>
<p><strong>äºŒçº§èœå•</strong></p>
<img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823170806043.png" alt="image-20210823170806043" style="zoom: 80%;">



<p>ç”±äºæœ¬èº«æ°´å¹³ä»¥åŠå¼€å‘å·¥å…·çš„é™åˆ¶ï¼Œåªèƒ½ä»¥ç®€å•çš„æ§åˆ¶å°æ¥æ¨¡æ‹Ÿç¨‹åºï¼Œä½†æ˜¯<strong>éº»é›€è™½å°äº”è„ä¿±å…¨</strong>ã€‚</p>
<p>å’Œä¸Šé¢è¡¨ç°çš„ä¸€æ ·ï¼Œæ§åˆ¶å°çš„ç¨‹åºåŒæ ·æ‹¥æœ‰ä¸€çº§èœå•ï¼ˆç™»å½•ä¹‹åçš„é€‰é¡¹ï¼‰å’ŒäºŒçº§èœå•ï¼ˆèŠå¤©ç•Œé¢ï¼‰</p>
<p>è€ƒè™‘åˆ°å¼€å‘çš„æ—¶é—´ï¼Œæœ¬ç¨‹åºç™»å½•ä¸éœ€è¦ç”¨æˆ·åä¸å¯†ç ï¼Œå¼€å¯ç¨‹åºåå³å¯è¿æ¥æœåŠ¡å™¨ï¼›ç”¨æˆ·èŠå¤©æ—¶æ ¹æ®IPä¸ç”µè„‘åæ¥æŸ¥æ‰¾èŠå¤©å¯¹è±¡ã€‚</p>
<p><strong>å®Œæˆæ­¤é¡¹ç›®éœ€è¦å¯¹å¤šçº¿ç¨‹æœ‰æ‰€äº†è§£ï¼ŒSocketçš„ç½‘ç»œçŸ¥è¯†ï¼Œå¯¹è±¡æµçš„IOï¼Œåºåˆ—åŒ–çŸ¥è¯†çš„åˆæ­¥äº†è§£ï¼ŒJAVAåŸºç¡€çŸ¥è¯†</strong></p>
<h2 id="æ­¥éª¤è®²è§£"><a href="#æ­¥éª¤è®²è§£" class="headerlink" title="æ­¥éª¤è®²è§£"></a>æ­¥éª¤è®²è§£</h2><p>å†™ç¨‹åºå‰è¦å…ˆæ„æ€ç”»å›¾ç¡®è®¤æ–¹æ¡ˆä¹‹åå†è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘å…ˆæŠŠåæœŸçš„ç”»é¢ä½¿ç”¨ç”»å›¾è½¯ä»¶ç¡®è®¤ä¸‹æ¥ã€‚</p>
<h3 id="view"><a href="#view" class="headerlink" title="view"></a>view</h3><p><strong>ä¸€çº§èœå•</strong>å¦‚ä¸‹ï¼š</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823172114325.png" alt="image-20210823172114325"></p>
<p><strong>äºŒçº§èœå•</strong>ï¼š</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823172204669.png" alt="image-20210823172204669"></p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å±€åŸŸç½‘é€šä¿¡æ˜¯å…¸å‹çš„Client - Serveræƒ…å½¢, æˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç«¯å§‹ç»ˆä¿æŒç€å¤šä¸ªSocketçº¿ç¨‹ï¼Œ è€ŒClientä¹Ÿèƒ½å¤Ÿæ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼šä¸€ä¸ªç”¨äºèŠå¤©ï¼Œä¸€ä¸ªç”¨äºä¼ è¾“æ–‡ä»¶(ç”±äºæœ€è¿‘æ—¶é—´æœ‰é™ï¼Œå°šæœªå¢æ·»æ­¤åŠŸèƒ½ï¼Œä¸è¿‡å’Œä¸Šé¢æœåŠ¡å™¨æ“ä½œæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä¹‹åè®²è§£å¯èƒ½æœ‰è®²åˆ°ï¼Œä½†ç¨‹åºä¸­å¹¶æœªæ·»åŠ æ­¤åŠŸèƒ½)ã€‚</p>
<p>æˆ‘ä»¬çš„å®¢æˆ·ç«¯æ¥æ”¶ä¿¡æ¯æ˜¯ä¸€ä¸ª<strong>åŠ¨æ€</strong>çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨èŠå¤©é¢æ¿æ‰“å¼€æ—¶æ¥æ”¶ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åœ¨åˆšç™»é™†æ—¶æ¥æ”¶ä¿¡æ¯ï¼Œå› æ­¤è¿™ä¹Ÿéœ€è¦çº¿ç¨‹çš„çŸ¥è¯†ï¼›</p>
<p><strong>è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿˜æ˜¯ç›´æ¥ç”»å¼ å›¾æ˜ç™½</strong>ï¼š</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/20210823_215520815_iOS-1629765663285.png" alt="20210823_215520815_iOS"></p>
<p>Tä»£è¡¨çº¿ç¨‹ï¼ŒSocketä»£è¡¨ä¼ è¾“ä¿¡æ¯çš„é€šé“ï¼Œå½“æˆ‘ä»¬æƒ³è¦æŠŠä¸€æ®µæ•°æ®å‘ç»™å…¶ä»–äººæ—¶ï¼Œæˆ‘ä»¬å…¶å®æ˜¯å…ˆæŠŠæ•°æ®å‘ç»™æœåŠ¡å™¨ï¼Œä»¥æœåŠ¡å™¨ä¸ºä¸­è½¬å†å°†å†…å®¹å‘ç»™æ¥æ”¶è€…ï¼ˆçœ‹ä¸Šé¢çš„ä¿¡æ¯æ•°æ®ä¼ è¾“ç®­å¤´ï¼‰</p>
<h3 id="ç±»å¯¹è±¡"><a href="#ç±»å¯¹è±¡" class="headerlink" title="ç±»å¯¹è±¡"></a>ç±»å¯¹è±¡</h3><p>çœ‹ç€ä¸Šé¢çš„å›¾æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä¹‹åå¯èƒ½è¦åˆ›å»ºçš„classç±»å¯¹è±¡</p>
<p><strong>å®¢æˆ·ç«¯</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823212629703.png" alt="image-20210823212629703"></p>
<p><strong>æœåŠ¡ç«¯</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823214129039.png" alt="image-20210823214129039"></p>
<h2 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h2><p>ç¡®å®šå®Œä¹‹å‰çš„ä¸€äº›ä¸œè¥¿ä¹‹åï¼Œè¦å¼€å§‹ç¼–ç </p>
<p>æˆ‘å°†ç¨‹åºåˆ†ä¸º<strong>å®¢æˆ·ç«¯</strong>ä¸<strong>æœåŠ¡ç«¯</strong>ä¸¤éƒ¨åˆ†</p>
<h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><p>å½“ç”¨æˆ·æ‰“å¼€ç¨‹åºæ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªUserç±»ï¼Œæ­¤ç±»å‚¨å­˜äº†ç”¨æˆ·çš„IPåœ°å€å’Œç”¨æˆ·ç”µè„‘çš„Local Host Name, è¿™æ ·ä¼šæ–¹ä¾¿ä¹‹åä½¿ç”¨ã€‚</p>
<pre><code class="java">package com.peter.Modle;

import java.net.InetAddress;
import java.net.NetworkInterface;
import java.net.SocketException;
import java.net.UnknownHostException;
import java.util.ArrayList;
import java.util.Enumeration;

public class User &#123;
    private String UID = &quot;127.0.0.1&quot;;
    private String Uname=null;
    
    public User()&#123;
/*
 * è€ƒè™‘åˆ°æˆ‘çš„ç”µè„‘å®‰è£…äº†è™šæ‹Ÿæœºï¼Œéœ€è¦æ£€æŸ¥å…·ä½“çš„IPï¼Œæ‰€ä»¥ä¸‹é¢çš„ç¨‹åºç”¨äºæ‰«ææœ¬æœºæ‰€æœ‰ç½‘ç»œç«¯å£ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©ç›¸åº”çš„ip
 * */
        try &#123;
            Uname = InetAddress.getLocalHost().getHostName(); //è·å–ä¸»æœºå
        &#125; catch (UnknownHostException e1) &#123;
            // TODO Auto-generated catch block
            e1.printStackTrace();
        &#125;
        Enumeration&lt;NetworkInterface&gt; i =null;
        try &#123;
            i = NetworkInterface.getNetworkInterfaces();
        &#125; catch (SocketException e) &#123;
            e.printStackTrace();
        &#125;
          ArrayList&lt;String&gt; IPlist = new ArrayList&lt;&gt;();  
          while(i.hasMoreElements())
            &#123;
                NetworkInterface n = i.nextElement();
                Enumeration&lt;InetAddress&gt; ea = n.getInetAddresses();
                
                while(ea.hasMoreElements())
                &#123;    
                    InetAddress a = ea.nextElement();
                    if(a.getHostAddress().toCharArray()[3] ==&#39;.&#39;) &#123;
                        IPlist.add(a.getHostAddress());
                    &#125;
                &#125;
            &#125;
//é€‰å–å¯¹åº”çš„IP(æ ¹æ®è‡ªå·±çš„è¦æ±‚)
          for(String ip:IPlist) &#123;
              if(ip.indexOf(&quot;137.&quot;)!=-1) &#123;
                  UID = ip;
                  break;
              &#125;
              if(ip.indexOf(&quot;192.&quot;)!=-1) &#123;
                  UID = ip;
              &#125;
          &#125;
    &#125;
    
    //è·å–ID
    public String getUID() &#123;
        return UID;
    &#125;
    
    //è·å–ä¸»æœºå
    public String getUname() &#123;
        return Uname;
    &#125;
&#125;
</code></pre>
<h4 id="MessageType"><a href="#MessageType" class="headerlink" title="MessageType"></a>MessageType</h4><p>è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­çš„å˜é‡éƒ½æ˜¯public static final, æ‰€ä»¥å¯ä»¥ç”¨æ¥å‚¨å­˜ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚æ¯ä¸ªæ•°å­—éƒ½æœ‰è‡ªå·±çš„å«ä¹‰ã€‚</p>
<pre><code class="java">package com.peter.Modle;
//æ–¹ä¾¿åˆ¤æ–­
public interface MessageType &#123;
    int allUsers = 0;
    int chat = 1;
    int sendFile = 2;
    int getFile = 3;
    int connect = 4;
    int exit = 9;
&#125;
</code></pre>
<h4 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h4><p>Messageæ˜¯ç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’ä¿¡æ¯çš„è½½ä½“ï¼Œé‡Œé¢åŒ…æ‹¬äº†è·å–åœ¨çº¿ç”¨æˆ·çš„å®¹å™¨[ArrayList], å‘Šè¯‰è®¡ç®—æœºæˆ‘ä»¬è¦åšä»€ä¹ˆçš„MessageType(MT), æœ‰Senderå’ŒReceiverï¼Œè¿˜æœ‰æœ€é‡è¦çš„Wordsï¼Œè¿™äº›ä¿¡æ¯éƒ½æ‰¿è½½åœ¨ä¸€ä¸ªMessageå¯¹è±¡ä¸­ï¼Œæœ€åè¦é€šè¿‡Socketçš„outputStreamå†™ç»™æœåŠ¡å™¨ï¼›ä¸ºä¿è¯Messageç±»èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ä¸­æ­£å¸¸è¢«è¯»å–ï¼Œæˆ‘ä»¬é‡‡ç”¨åºåˆ—åŒ–æ“ä½œï¼Œç»§æ‰¿Serializableæ¥å£ï¼Œå‚¨å­˜äº†SerialVersionUID.</p>
<pre><code class="java">package com.peter.Modle;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Map;
import java.util.Set;

public class Message implements Serializable&#123;
    private static final long serialVersionUID = 1L;
    
    private String words=null;
    private int MT = 9;
    private String sender=null;
    private String receiver=null;
    private ArrayList&lt;String&gt; users =null;
    
    
    public ArrayList&lt;String&gt; getUsers() &#123;
        return users;
    &#125;
    public void setUsers(ArrayList&lt;String&gt; users) &#123;
        this.users = users;
    &#125;
    public String getSender() &#123;
        return sender;
    &#125;
    public void setSender(String sender) &#123;
        this.sender = sender;
    &#125;
    public String getReceiver() &#123;
        return receiver;
    &#125;
    public void setReceiver(String receiver) &#123;
        this.receiver = receiver;
    &#125;
    public String getWords() &#123;
        return words;
    &#125;
    public void setWords(String words) &#123;
        this.words = words;
    &#125;
    public int getMT() &#123;
        return MT;
    &#125;
    public void setMT(int mT) &#123;
        MT = mT;
    &#125;
    
&#125;
</code></pre>
<h4 id="UserThread"><a href="#UserThread" class="headerlink" title="UserThread"></a>UserThread</h4><p>ç”¨æˆ·çš„çº¿ç¨‹ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯çš„å¼€å¯å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œmainå‡½æ•°æ˜¯ä¸»è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¸ºäº†è®©ç”¨æˆ·å¼€å¯ç¨‹åºå°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä»»ä½•æ—¶å€™éƒ½èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ğŸ˜‰ï¼Œäºæ˜¯å¯ç”¨å¤šçº¿ç¨‹æœåŠ¡ï¼ŒUserThreadå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹</p>
<pre><code class="java">package com.peter.Modle;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.net.Socket;
import java.util.ArrayList;
import java.util.Map;
import java.util.Set;


//ç”¨æˆ·çº¿ç¨‹ç±»ï¼Œç”¨äºæ¥æ”¶æœåŠ¡å™¨å‘é€è¿‡æ¥çš„ä¿¡æ¯
public class UserThread extends Thread&#123;//æ­¤çº¿ç¨‹ç»§æ‰¿Threadç±»
    private Socket UserSocket=null;
    private static ArrayList&lt;String&gt; allUsers=null;
    private static ArrayList&lt;String&gt; ChatContent=new ArrayList&lt;&gt;();
//allUsers å’Œ ChatContentéƒ½ä½¿ç”¨é™æ€å˜é‡çš„åŸå› æ˜¯ï¼šä¸€æ—¦ç¨‹åºå¼€å¯ï¼Œä»–ä»¬å°±å¯ä»¥ä¸€ç›´å…¨å±€è®¿é—®    
    public UserThread(Socket us) &#123;
        UserSocket = us;
    &#125;
    
    public Socket getUserSocket() &#123;
        return UserSocket;
    &#125;

    public ArrayList&lt;String&gt; getAllUsers() &#123;
        return allUsers;
    &#125;
    
    public ArrayList&lt;String&gt; getContent()&#123;
        return ChatContent;
    &#125;

//é‡å†™Runæ–¹æ³•
    @Override
    public void run() &#123;
        //ä½¿ç”¨å¾ªç¯è¡¨ç¤ºä¸€ç›´åœ¨è¿è¡Œï¼Œä¸ç„¶è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€éåå°±ä¸æ‰§è¡Œäº†
        while(true) &#123;
            ObjectInputStream ois;
            try &#123;
                ois = new ObjectInputStream(UserSocket.getInputStream());
                Message mms = (Message)ois.readObject(); //å¦‚æœæœåŠ¡å™¨æ²¡æœ‰å‘é€æ•°æ®ï¼Œé€šé“ä¼šä¸€ç›´é˜»å¡
                //æœåŠ¡å™¨å‘ç”¨æˆ·å‘é€çš„messageæ˜¯allUser
                if(mms.getMT() == MessageType.allUsers) &#123;
                    UserThread.allUsers = mms.getUsers();
                //å‘é€ä½†æ˜¯ä¿¡æ¯                    
                &#125;else if(mms.getMT() == MessageType.chat) &#123;
                    ChatContent.add(mms.getSender()+&quot; å¯¹ &quot;+mms.getReceiver()+&quot; è¯´:\n &quot;+mms.getWords());
                    System.out.println(&quot;è¿‡å¾€ä¿¡æ¯ï¼š&quot;);
                    //æ˜¾ç¤ºè¿‡å¾€æ¶ˆæ¯ä¿¡æ¯
                    for(String chatContent:ChatContent)
                        System.out.println(chatContent);
                &#125;
                
            &#125; catch (IOException e) &#123;
                // TODO Auto-generated catch block
                e.printStackTrace();
            &#125; catch (ClassNotFoundException e) &#123;
                // TODO Auto-generated catch block
                e.printStackTrace();
            &#125;
        
            
            
        &#125;
    &#125;
    
&#125;
</code></pre>
<h4 id="UserConnectService"><a href="#UserConnectService" class="headerlink" title="UserConnectService"></a>UserConnectService</h4><p>å¼€å§‹ç”¨æˆ·éœ€è¦å°†ç”µè„‘è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œä»¥æ­¤æ¥æ„å»ºSocketé€šä¿¡,å¹¶å¼€å¯çº¿ç¨‹</p>
<pre><code class="java">    public static void ConnectToServer() &#123;
        try &#123;
            //137.112.237.25æ˜¯æœåŠ¡å™¨æ‰€åœ¨IPï¼Œ10086æ˜¯ç›‘å¬ç«¯å£
            UserSocket = new Socket(&quot;137.112.237.25&quot;, 10086);
            //åˆ›å»ºMessageå¯¹è±¡ï¼Œåœ¨è¿™ä¸ªè½½ä½“ä¸­å†™å…¥æˆ‘ä»¬çš„ä¿¡æ¯
            Message message = new Message();
            message.setMT(MessageType.connect);
            message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
            
            //è¾“å‡ºæµå°†messageå¯¹è±¡å†™ç»™æœåŠ¡å™¨ç«¯
            ObjectOutputStream output = new ObjectOutputStream(UserSocket.getOutputStream());
            output.writeObject(message);
            
            //æˆ‘ä»¬æŠŠè¿™ä¸ªå»ºç«‹è¿æ¥çš„Socketæ”¾å…¥åˆ°çº¿ç¨‹ï¼ŒæŒç»­ç›‘å¬æœåŠ¡å™¨å‘é€çš„ä¿¡æ¯
            userThread = new UserThread(UserSocket);
            userThread.start();//åˆ«å¿˜äº†å¼€å¯çº¿ç¨‹
            
            
        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
    &#125;
</code></pre>
<p>è·å–åœ¨çº¿ç”¨æˆ·çš„IPå’Œåç§°</p>
<pre><code class="java">//è·å–åœ¨çº¿ç”¨æˆ·IP
    public static ArrayList&lt;String&gt; GetAllIP() &#123;

        //å»ºç«‹Messageå¯¹è±¡
        Message message = new Message();
        message.setMT(MessageType.allUsers);
        //è¿™ä¸ªæ˜¯ä¸ºäº†æ–¹ä¾¿æœåŠ¡å™¨åˆ¤æ–­IPï¼Œè¿™æ ·å°±ä¸ä¼šå‘é€æœ¬æœºçš„IPäº†
        message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
        try &#123;
            //å‘é€
            ObjectOutputStream output = new ObjectOutputStream(userThread.getUserSocket().getOutputStream());
            output.writeObject(message);
            //ç­‰å¾…æ¥æ”¶IPï¼Œç½‘ç»œæœ‰å»¶è¿Ÿ
            if(userThread.getAllUsers() == null) &#123;
                Thread.sleep(5000);
            &#125;
            //ç­‰ä¸€ä¼šä¹‹åè¿˜æ²¡æœ‰å°±è¿”å›ç©º
            if(userThread.getAllUsers() == null)
                return null;
            return userThread.getAllUsers();
            
        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125; catch (InterruptedException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
        return null;
    &#125;
</code></pre>
<p>å‘æŒ‡å®šç”¨æˆ·ä¼ è¾“ä¿¡æ¯</p>
<p>è¿™é‡Œæˆ‘ä»¬è¦è¾“å…¥å¯¹åº”çš„IPåœ°å€å’Œä¿¡æ¯ï¼Œç”±äºæ˜¯Serviceï¼Œæˆ‘åšæˆäº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ–¹ä¾¿ä¹‹ååœ¨Menusï¼ˆViewï¼‰ä¸­è°ƒç”¨ã€‚</p>
<pre><code class="java">  //å‘æŒ‡å®šç”¨æˆ·ä¼ è¾“ä¿¡æ¯
    public static String SendChatContent(String receiver, String words)&#123;
        //åŒä¸Š
        Message message =  new Message();
        message.setMT(MessageType.chat);
        message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
        message.setReceiver(receiver);
        //æˆ‘ä»¬è¦åŠ å…¥å‘é€çš„æ—¶é—´
        Date date = new Date();
        message.setWords(words+&quot;\t&quot;+date.toString());
        
        try &#123;
            ObjectOutputStream output = new ObjectOutputStream(userThread.getUserSocket().getOutputStream());
            output.writeObject(message);
            
            String words1 = message.getSender()+&quot; å¯¹ &quot;+message.getReceiver()+&quot; è¯´:\n &quot;+message.getWords();
            
            //userThread.getContent().add(words1);
            //è¿”å›å‘é€çš„å†…å®¹ï¼Œåˆ°æ—¶å€™åœ¨Viewæ§åˆ¶å°ä¸­æ‰“å°å‡ºæ¥
            return words1;

        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
        
        return &quot;è¿æ¥è¶…æ—¶ï¼Œä¿¡æ¯æœªå‘é€&quot;;
    &#125; 
</code></pre>
<p>é€€å‡ºæœåŠ¡</p>
<p>é€€å‡ºä¹‹å‰æˆ‘ä»¬è¦å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬è¦é€€å‡ºäº†ï¼Œè®©æœåŠ¡å™¨åœ¨æœåŠ¡å™¨ä¸­åˆ é™¤æˆ‘ä»¬çš„çº¿ç¨‹ï¼Œå…³é—­æˆ‘ä»¬çš„Socketé€šé“ï¼Œæˆ‘ä»¬ç„¶åç›´æ¥é€€å‡ºã€‚</p>
<pre><code class="java">    //é€€å‡ºæœåŠ¡
    public static void Exit() &#123;
        //å‘æœåŠ¡å™¨å‘é€é€€å‡ºæŒ‡ä»¤
        Message message = new Message();
        message.setMT(MessageType.exit);
        message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
        
        try &#123;
            ObjectOutputStream output = new ObjectOutputStream(userThread.getUserSocket().getOutputStream());
            output.writeObject(message);
            System.exit(0);//ç³»ç»Ÿé€€å‡º
        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
        
        
    &#125;
</code></pre>
<p>UserConnectService å…¨éƒ¨ä»£ç ï¼Œéƒ½æ˜¯public static method</p>
<pre><code class="java">package com.peter.Service;

import java.io.IOException;
import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.net.Socket;
import java.util.ArrayList;
import java.util.Date;
import java.util.Map;
import java.util.Set;

import com.peter.Modle.Message;
import com.peter.Modle.MessageType;
import com.peter.Modle.User;
import com.peter.Modle.UserThread;

public class UserConnectService &#123;
    private static Socket UserSocket = null;
    private static User user= new User();
    private static UserThread userThread;
    public static void ConnectToServer() &#123;
        try &#123;
            UserSocket = new Socket(&quot;137.112.237.25&quot;, 10086);
            Message message = new Message();
            message.setMT(MessageType.connect);
            message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
            
            
            ObjectOutputStream output = new ObjectOutputStream(UserSocket.getOutputStream());
            output.writeObject(message);
            
            userThread = new UserThread(UserSocket);
            userThread.start();
            
            
        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
    &#125;
    
    //è·å–åœ¨çº¿ç”¨æˆ·IP
    public static ArrayList&lt;String&gt; GetAllIP() &#123;

        
        Message message = new Message();
        message.setMT(MessageType.allUsers);
        message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
        try &#123;
            ObjectOutputStream output = new ObjectOutputStream(userThread.getUserSocket().getOutputStream());
            output.writeObject(message);
            //ç­‰å¾…å‘é€IP
            if(userThread.getAllUsers() == null) &#123;
                Thread.sleep(5000);
            &#125;
            if(userThread.getAllUsers() == null)
                return null;
            return userThread.getAllUsers();
            
        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125; catch (InterruptedException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
        return null;
    &#125;
    
    //å‘æŒ‡å®šç”¨æˆ·ä¼ è¾“ä¿¡æ¯
    public static String SendChatContent(String receiver, String words)&#123;
        Message message =  new Message();
        message.setMT(MessageType.chat);
        message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
        message.setReceiver(receiver);
        Date date = new Date();
        message.setWords(words+&quot;\t&quot;+date.toString());
        
        try &#123;
            ObjectOutputStream output = new ObjectOutputStream(userThread.getUserSocket().getOutputStream());
            output.writeObject(message);
            String words1 = message.getSender()+&quot; å¯¹ &quot;+message.getReceiver()+&quot; è¯´:\n &quot;+message.getWords();
            userThread.getContent().add(words1);
            return words1;

        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
        
        return &quot;è¿æ¥è¶…æ—¶ï¼Œä¿¡æ¯æœªå‘é€&quot;;
    &#125; 
    
    //é€€å‡ºæœåŠ¡
    public static void Exit() &#123;
        //å‘æœåŠ¡å™¨å‘é€é€€å‡ºæŒ‡ä»¤
        Message message = new Message();
        message.setMT(MessageType.exit);
        message.setSender(user.getUname()+&quot;:&quot;+user.getUID());
        
        try &#123;
            ObjectOutputStream output = new ObjectOutputStream(userThread.getUserSocket().getOutputStream());
            output.writeObject(message);
            System.exit(0);//ç³»ç»Ÿé€€å‡º
        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
        
        
    &#125;
    
&#125;
</code></pre>
<h4 id="Menus"><a href="#Menus" class="headerlink" title="Menus"></a>Menus</h4><p>menusæ˜¯èœå•ï¼Œä¸€çº§èœå•ï¼ŒäºŒçº§èœå•çš„æ˜¾ç¤ºéƒ½åœ¨è¿™é‡Œï¼Œå¯ä»¥è¯´æ˜¯æ˜¾ç¤ºå±‚</p>
<pre><code class="java">package com.peter.View;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;

import com.peter.Service.UserConnectService;

import java.util.Scanner;
import java.util.Set;

public class Menus &#123;
    //åˆ°æ—¶å€™æµ‹è¯•ç±»è°ƒç”¨Startæ–¹æ³•å°±å¥½
    public static void Start() &#123;
        FirstMenu();
    &#125;
    //æ˜¾ç¤ºä¸€çº§èœå•
    private static void FirstMenu() &#123;
        boolean open =true;
        Scanner input =null;
        UserConnectService.ConnectToServer();
        //ä¸€çº§èœå•ä½¿ç”¨å¾ªç¯ï¼Œè‹¥é€€å‡ºåˆ™å¾ªç¯ç»ˆæ­¢
        while(open) &#123;
            System.out.println(&quot;\n\n====èŠå¤©ä¸€çº§èœå•====&quot;);
            System.out.println(&quot;\t1. èŠå¤©é¢ç‰ˆ&quot;);
            System.out.println(&quot;\t4.é€€å‡º&quot;);
            System.out.print(&quot;   é€‰æ‹©ï¼š&quot;);
            input = new Scanner(System.in);
            switch (input.next()) &#123;
            case &quot;1&quot;:
                Chatting(input);
                break;
                
            case &quot;4&quot;:
                UserConnectService.Exit();
                open = false;
                break;
            default:
                break;
            &#125;
        &#125;
        
        input.close();
    

        
        
    &#125;
    
    //äºŒçº§èœå•
    private static void Chatting(Scanner input) &#123;
        boolean open = true;
        //åŒæ ·ä½¿ç”¨å¾ªç¯æ§åˆ¶ï¼Œæ–¹ä¾¿æŒç»­äº¤æµ
        while(open) &#123;
            
            System.out.println(&quot;\n\n====èŠå¤©äºŒçº§èœå•(èŠå¤©é¢æ¿)====&quot;);
            System.out.println(&quot;åœ¨çº¿è”ç³»äººå¦‚ä¸‹ï¼š&quot;);
            //å†…å®¹çš„è·å–éƒ½æ˜¯æ ¹æ®ä¹‹å‰çš„UserConnectServiceå·¥å…·ç±»æ¥è·å¾—
            ArrayList&lt;String&gt; tmpSet = UserConnectService.GetAllIP();
            
            //è‹¥æ— åœ¨çº¿ç”¨æˆ·ï¼Œç›´æ¥ä¸è®©ç”¨æˆ·è¿›è¡Œäº¤æµ
            if(tmpSet == null) &#123;
                System.out.println(&quot;æš‚æ—¶æ— ä¸Šçº¿ç”¨æˆ·&quot;);
                open = false;
            &#125;else &#123;
                //æœ‰åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæ‰“å°åœ¨çº¿ç”¨æˆ·
                for(String tmp: tmpSet) &#123;
                    System.out.println(tmp);
                &#125;
                
                System.out.println(&quot;\n\t1.é€‰æ‹©äººèŠå¤©&quot;);
                System.out.println(&quot;\t2.é€€å‡º&quot;);
                System.out.print(&quot;ä½ çš„é€‰æ‹©ï¼š&quot;);
                String choice = input.next();
                input.reset();//ä¸ºé¿å…scannerçš„é—®é¢˜ï¼Œä½¿ç”¨reseté‡å¯æ–¹æ³•
                
                switch (choice) &#123;
                case &quot;1&quot;:
                    
                    System.out.print(&quot;èŠå¤©å¯¹è±¡çš„IPï¼š&quot;);
                    String receiver = input.next();
                    input.reset();
                    System.out.print(&quot;æƒ³è¯´çš„è¯ï¼š&quot;);
                    input.nextLine();//åƒæ‰ä¸€ä¸ª\n
                    String words = input.nextLine();
                    input.reset();
                    //æ‰“å°åˆšæ‰å‘é€çš„ä¿¡æ¯
                    System.out.println(UserConnectService.SendChatContent(receiver, words));
                    break;
                    
                case &quot;2&quot;:
                    open = false;
                    break;
                default:
                    break;
                &#125;
            &#125;
        &#125;
        
    &#125;
&#125;
</code></pre>
<h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><h4 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h4><p>æœåŠ¡å™¨ç»ˆç«¯ç±»ï¼Œç”¨äºæ§åˆ¶æœåŠ¡å™¨çš„å¼€å¯ï¼Œéœ€è¦å¼€å¯æœåŠ¡å™¨ç«¯å…ˆå®ä¾‹åŒ–ä¸€ä¸ªTerminalå¯¹è±¡ï¼Œä¼ å…¥æœåŠ¡å™¨ç›‘å¬ç«¯å£</p>
<p>æœåŠ¡å™¨ç«¯æ˜¯ä¸€ç›´è¿›è¡Œwhileå¾ªç¯ï¼Œç”¨äºæŒç»­ç›‘å¬æ˜¯å¦æœ‰æ–°çš„è¿æ¥</p>
<pre><code class="java">package com.peter.Modle;


import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.ServerSocket;
import java.net.Socket;
/*
 * æœåŠ¡å™¨ç±»
 * 
 * */
public class Terminal &#123;
    private ServerSocket listener; //ç”¨äºç›‘å¬ç«¯å£
    public Terminal(int port)&#123;
        try &#123;
            System.out.println(&quot;æœåŠ¡å™¨Start&quot;);
            listener = new ServerSocket(port); //ç¡®è®¤ç«¯å£
            Socket accept; //è¿æ¥çš„Socketé€šé“
            while(true) &#123;
                accept = listener.accept(); //å»ºç«‹é€šé“è¿æ¥
                //è·å–è¿æ¥åå°†æ­¤socketé€šé“æ”¾å…¥çº¿ç¨‹å’Œçº¿ç¨‹æ± ä¸­è¿›è¡Œç®¡ç†
                ObjectInputStream input = new ObjectInputStream(accept.getInputStream());
                Message message = (Message)input.readObject();//å¼€å§‹æ—¶åˆ¤æ–­æ˜¯å¦æ˜¯åœ¨ç™»å½•
                if(message.getMT() == MessageType.connect) &#123;
                    ServerThread thread = new ServerThread(accept, message.getSender());
                    System.out.println(message.getSender()+&quot;ä¸Šçº¿äº†&quot;);
                    thread.start();//å¼€å¯çº¿ç¨‹
                    ManageClientThreads.addThread(message.getSender(), thread);//åŠ å…¥åˆ°çº¿ç¨‹æ± ä¸­
                &#125;
                
                
            &#125;
             
        &#125; catch (IOException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125; catch (ClassNotFoundException e) &#123;
            // TODO Auto-generated catch block
            e.printStackTrace();
        &#125;
    &#125;
    
&#125;
</code></pre>
<h4 id="ServerThread"><a href="#ServerThread" class="headerlink" title="ServerThread"></a>ServerThread</h4><p>æœåŠ¡å™¨çš„çº¿ç¨‹ç±»ï¼Œå’Œå®¢æˆ·ç«¯çš„çº¿ç¨‹ç±»ä¸€æ ·ï¼Œ</p>
<pre><code class="java">package com.peter.Modle;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.Socket;

import com.peter.Service.ShowOnline;

public class ServerThread extends Thread&#123;
    private Socket socket;
    private String UID;
    //åœ¨æœåŠ¡å™¨ç«¯ç®¡ç†çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰å¯¹åº”çš„UID
    public ServerThread(Socket s, String id) &#123;
        socket = s;
        UID =id;
    &#125;
    
    public String getUID() &#123;
        return UID;
    &#125;
    
    public Socket getSocket() &#123;
        return socket;
    &#125;


    @Override
    public void run() &#123;
        //ä½¿ç”¨å¾ªç¯ï¼Œä½¿æ­¤socketçº¿ç¨‹ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€ï¼Œè‹¥æ²¡æœ‰å†…å®¹å‘è¿‡æ¥ï¼Œåˆ™é˜»å¡åœ¨æ­¤
        while(true) &#123;
            Message message;
            try &#123;
                ObjectInputStream input = new ObjectInputStream(socket.getInputStream());
                message = (Message)input.readObject();
                
                //åˆ¤æ–­å‘é€è¿‡æ¥çš„å†…å®¹
                if(message.getMT()==MessageType.allUsers) &#123; //è¯·æ±‚æ‰€æœ‰åœ¨çº¿ç”¨æˆ·
                    System.out.println(UID+&quot;å‘æœåŠ¡å™¨è¯·æ±‚åœ¨çº¿ç”¨æˆ·&quot;);
                    message.setUsers(ShowOnline.getAllIP(UID));
                    ObjectOutputStream output = new ObjectOutputStream(socket.getOutputStream());
                    output.writeObject(message);
                    
                &#125;
                
                else if(message.getMT() == MessageType.chat) &#123;//Aç”¨æˆ·è¯·æ±‚ä¸Bç”¨æˆ·é€šä¿¡
                    String receiver = message.getReceiver();
                    ServerThread receiverThread = ManageClientThreads.getThread(receiver);//æˆ‘ä»¬å…ˆæ ¹æ®Bç”¨æˆ·çš„åç§°æ‰¾åˆ°Bç”¨æˆ·çš„çº¿ç¨‹
                    System.out.println(message.getSender()+&quot;å‘&quot;+receiver+&quot;å‘é€:\n&quot;+message.getWords());
                    //åˆ¤æ–­ä¸€ä¸‹æ­¤ç”¨æˆ·æ˜¯å¦å­˜åœ¨
                    if(receiverThread!=null) &#123;
                        
                        ObjectOutputStream output = new ObjectOutputStream(receiverThread.getSocket().getOutputStream());
                        output.writeObject(message);
                    &#125;else &#123;
                        //è‹¥ä¸å­˜åœ¨ï¼Œè¿™ä¸ªæ€ä¹ˆå¤„ç†è¿˜æ²¡å†™
                    &#125;
                    
                &#125;
                else if(message.getMT()==MessageType.exit) &#123; //è¯·æ±‚é€€å‡º
                    //é€€å‡ºæ—¶ä»çº¿ç¨‹æ± ä¸­åˆ é™¤ï¼Œå°†socketé€šé“å…³é—­
                    ManageClientThreads.delThread(UID);
                    socket.close();
                    System.out.println(message.getSender()+&quot;é€€å‡º&quot;);
                    break; //ç»ˆæ­¢å¾ªç¯
                &#125;
                
            &#125; catch (IOException e) &#123;
                // TODO Auto-generated catch block
                e.printStackTrace();
            &#125; catch (ClassNotFoundException e) &#123;
                // TODO Auto-generated catch block
                e.printStackTrace();
            &#125;
            
        &#125;
    &#125;

&#125;
</code></pre>
<h4 id="ManageClientThreads"><a href="#ManageClientThreads" class="headerlink" title="ManageClientThreads"></a>ManageClientThreads</h4><p>çº¿ç¨‹æ± ï¼Œç®¡ç†çº¿ç¨‹ï¼Œå¯¹çº¿ç¨‹è¿›è¡Œå¢åˆ æŸ¥</p>
<p>æ¯ä¸ªçº¿ç¨‹è¢«å‚¨å­˜åœ¨HashMapä¸­ï¼Œä»¥ç”¨æˆ·IDä¸ºkey, Threadä¸ºvalueï¼Œæ–¹ä¾¿æŸ¥è¯¢</p>
<pre><code class="java">package com.peter.Modle;

import java.util.HashMap;
//ç®¡ç†çº¿ç¨‹çš„ç±»ï¼Œçº¿ç¨‹æ± 
public class ManageClientThreads &#123;
    public static HashMap&lt;String, ServerThread&gt; threads = new HashMap&lt;&gt;();
    //UIDä¸ºçº¿ç¨‹Keyï¼Œsocketä¸ºvalue
    public static void addThread(String UID, ServerThread s ) &#123;
        threads.put(UID, s);
        
    &#125;
    //åˆ é™¤çº¿ç¨‹
    public static void delThread(String UID) &#123;
        threads.remove(UID);
    &#125;
    //è·å–å¯¹åº”çº¿ç¨‹
    public static ServerThread getThread(String UID) &#123;
        for(String id:threads.keySet()) &#123;
            if(KMP(id,UID,MatchMap(UID))!=-1) &#123;
                return threads.get(id);
            &#125;
                
        &#125;
        return null;
    &#125;
    
    //ç”±äºç”¨æˆ·å­˜å‚¨çš„æ˜¯ç”¨æˆ·å+IPï¼Œè€Œå½“ç”¨æˆ·è¦ä¸å¦å¤–ä¸€ä¸ªç”¨æˆ·é€šä¿¡æ—¶è¾“å…¥çš„æ˜¯IPåœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦åšå­—ç¬¦ä¸²åŒ¹é…ä»¥æ‰¾åˆ°ç¬¦åˆçš„å­—ç¬¦ä¸²
    //ä½¿ç”¨KMPç®—æ³•åšå­—ç¬¦ä¸²åŒ¹é…
    private static int[] MatchMap(String dest) &#123;
        int[] map = new int[dest.length()];
        map[0]=0;
        for(int i=0,j=0;i&lt;dest.length();i++) &#123;
            while(j&gt;0&amp;&amp;dest.charAt(i)!=dest.charAt(j))
                j = map[j-1];
            if(dest.charAt(i)==dest.charAt(j))
                j++;
            map[i] = j;
            
        &#125;
        return map;
    &#125;
    
    private static int KMP(String st1, String st2, int[] map) &#123;
        for(int i=0, j=0;i&lt;st1.length();i++) &#123;
            while(j&gt;0&amp;&amp;st1.charAt(i)!=st2.charAt(j))
                j = map[j-1];
            if(st1.charAt(i)==st2.charAt(j))
                j++;
            if(j&gt;=st2.length())
                return i-j+1;
        &#125;
        return -1;
    &#125;
    
&#125;
</code></pre>
<h4 id="ShowOnline"><a href="#ShowOnline" class="headerlink" title="ShowOnline"></a>ShowOnline</h4><p>æ˜¾ç¤ºæ‰€æœ‰åœ¨çº¿ç”¨æˆ·ï¼Œå…¶å®å°±æ˜¯éå†çº¿ç¨‹æ± ï¼Œå°†æ¯ä¸ªKeyï¼ˆé™¤æŸ¥è¯¢æœ¬æœºçš„ç”¨æˆ·ä»¥å¤–ï¼‰è¿”å›ç»™æ­¤æŸ¥è¯¢ç”¨æˆ·</p>
<pre><code class="java">package com.peter.Service;

import java.util.ArrayList;
import java.util.Set;

import com.peter.Modle.ManageClientThreads;

public class ShowOnline &#123;
    //æ ¹æ®çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè·å–æ‰€æœ‰UIDï¼Œå³åœ¨çº¿çš„ç”¨æˆ·
    public static ArrayList&lt;String&gt; getAllIP(String UID)&#123;
        ArrayList&lt;String&gt; ips = new ArrayList&lt;&gt;(ManageClientThreads.threads.keySet());
        ips.remove(UID); //åœ¨çº¿ç”¨æˆ·æŸ¥çœ‹æ—¶ï¼Œæ’é™¤ç”¨æˆ·è‡ªå·±
        return ips;
    &#125;
&#125;
</code></pre>
<h4 id="MessageTypeå’ŒMessage"><a href="#MessageTypeå’ŒMessage" class="headerlink" title="MessageTypeå’ŒMessage"></a>MessageTypeå’ŒMessage</h4><p>MessageTypeå’ŒMessageä¸å®¢æˆ·ç«¯æ˜¯ä¸€æ ·çš„ï¼ŒMessageTypeå°±å¥½åƒæ˜¯ä¸€ä¸ªå¯†ç æœ¬ï¼Œä½¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨äº†è§£å½¼æ­¤è¦åšçš„äº‹ã€‚Messageå¿…é¡»è¦è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼ŒåŒæ—¶ä¿è¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„Messageå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·åœ¨ä»å®¢æˆ·ç«¯ä¼ è¾“Messageå¯¹è±¡åˆ°æœåŠ¡å™¨ç«¯æ—¶å°±ä¸ä¼šæŠ¥é”™ï¼Œï¼ˆClass Not Found Exceptionï¼‰</p>
<h2 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h2><p>æœ¬ç¨‹åºæœ‰è®¸å¤šå¯æ‹“å±•çš„åœ°æ–¹ï¼Œå¦‚è®©ç”¨æˆ·ä¹‹é—´å¯ä»¥ä¼ è¾“æ–‡ä»¶ï¼Œå½“ç”¨æˆ·è¾“å…¥é”™çš„IPæ—¶ï¼ŒæœåŠ¡å™¨ä¼šæç¤ºç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æœ‰é”™è¯¯ç­‰ç­‰ã€‚æ—¶é—´æœ‰é™ï¼Œéƒ¨åˆ†åŠŸèƒ½å°šæœªå®Œæˆï¼Œè¯·è°…è§£ã€‚</p>
<h2 id="å±•ç¤ºæ•ˆæœ"><a href="#å±•ç¤ºæ•ˆæœ" class="headerlink" title="å±•ç¤ºæ•ˆæœ"></a>å±•ç¤ºæ•ˆæœ</h2><p>æœ€ååªéœ€è¦å°†Menuså’ŒTerminalåˆ†åˆ«æ”¾åˆ°2ä¸ªæµ‹è¯•ç±»å½“ä¸­å°±å¥½ï¼Œè¿™æ ·å°±èƒ½å¼€å§‹è¿›è¡ŒæœåŠ¡å™¨ï¼Œ2å°å®¢æˆ·ç«¯é—´çš„é€šä¿¡äº†ã€‚ä¸‹é¢æ˜¯æˆæœå±•ç¤ºï¼š</p>
<p><strong>æœåŠ¡å™¨ç«¯</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221202447.png" alt="image-20210823221202447"></p>
<p><strong>å®¢æˆ·ç«¯</strong></p>
<p>ä¸€çº§èœå•</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221307532.png" alt="image-20210823221307532"></p>
<p>äºŒçº§èœå•</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221327569.png" alt="image-20210823221327569"></p>
<p>äºŒçº§èœå•æ”¶åˆ°å¦ä¸€ä¸ªç”¨æˆ·å‘æ¥çš„ä¿¡æ¯(ç”±äºæ˜¯æ§åˆ¶å°è¡¨ç¤ºä¿¡æ¯æ”¶å‘ä¸é€‰é¡¹é€‰æ‹©ï¼Œä¿¡æ¯æ˜¾ç¤ºä¼šæœ‰æ‰€å†²çª)</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221648652.png" alt="image-20210823221648652"></p>
<p>å®‰å…¨é€€å‡º</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221706176.png" alt="image-20210823221706176"></p>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><p>è¿™ä¸ªç¨‹åºè¯´å®è¯åšçš„æœ‰ç‚¹è‰ç‡ï¼Œå¾ˆå¤šåœ°æ–¹å…¶å®æœ‰Bugï¼Œè®¸å¤šè¾¹é™…æƒ…å†µç¡®å®æ²¡æœ‰è€ƒè™‘ï¼Œä½†è¿™ä¾ç„¶ä¸å¤±æ˜¯ä¸€ä¸ªå¥½çš„ç»ƒä¹ é¢˜ï¼Œç”¨æ¥ç»ƒä¹ å¤šçº¿ç¨‹ç®¡ç†ï¼ŒSocketé€šä¿¡ç­‰ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>HSPè€å¸ˆçš„è§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j54y1b7qv?p=30">https://www.bilibili.com/video/BV1j54y1b7qv?p=30</a></p>

    </div>
    
    
    
</div>
                        <footer id="footer">
    <div class="footer-wrap">
        <div>
            Â© 2020 - 2024 Yao Xiong
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Yao Xiong
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        


    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>