
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>JAVAå±€åŸŸç½‘èŠå¤©å°ç¨‹åº | Yao Xiong</title>
        <meta name="author" content="Yao Xiong">
        <meta name="description" content="è«å¬ç©¿æ—æ‰“å¶å£°ï¼Œ ä½•å¦¨åŸå•¸ä¸”å¾è¡Œ">
        <meta name="keywords" content="Yao Xiong Projects">
        <link rel="icon" href="/img/favicon.png">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.2.0/js/all.min.js"></script>
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 7.2.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:2147483647;justify-content:space-between;background:#fff;transition:all 0.3s ease-out;-webkit-user-select:none;-moz-user-select:none;user-select:none"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜(æµè§ˆå™¨é»˜è®¤å¼€å¯)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="showpage" style="display: -not-none">
                    <div id="menushow">
                        <nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">Yao Xiong</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;projects</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menushow" id="phone-menu">
        <div class="curtain" @click="menushow = !menushow" v-show="menushow"></div>
        <div class="title" @click="menushow = !menushow">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;Yao Xiong</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menushow">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">projects</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        <div class="article">
    <div>
        <h1>JAVAå±€åŸŸç½‘èŠå¤©å°ç¨‹åº </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2021/8/23
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
            </span>
            
            <span class="tag">
                
                <a href="/tags/JAVA/" style="color: #00a596">
                    JAVA
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/TCP-IP%E5%8D%8F%E8%AE%AE/" style="color: #00bcd4">
                    TCP/IPåè®®
                </a>
            </span>
            
        </span>
        
    </div>
    <div class="content" v-pre>
        <h1 id="ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP-IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡"><a href="#ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP-IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡" class="headerlink" title="ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP&#x2F;IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡"></a>ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰TCP&#x2F;IPåè®®çš„å±€åŸŸç½‘Socketé€šä¿¡</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>é©¬ä¸Šå¼€å­¦äº†ï¼Œé—²ç€æ²¡äº‹åšï¼Œå†³å®šé‡æ–°æ¸©ä¹ JAVAåŠŸè¯¾ï¼Œäºæ˜¯æƒ³èµ·äº†æ›¾ç»è§è¿‡çš„ä¸€ä¸ªé¡¹ç›®ï¼šåŸºäºJAVAè¯­è¨€çš„å±€åŸŸç½‘é€šä¿¡ï¼Œå¯ä»¥å‚è€ƒQQï¼Œå¦‚ä¸‹</p>
<span id="more"></span>

<p><strong>ä¸€çº§èœå•</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823171022391.png" alt="image-20210823171022391"></p>
<p><strong>äºŒçº§èœå•</strong></p>
<img src="2021-08-23-JAVAå±€åŸŸç½‘èŠå¤©å°ç¨‹åº/image-20210823170806043.png" alt="image-20210823170806043" style="zoom: 80%;" />



<p>ç”±äºæœ¬èº«æ°´å¹³ä»¥åŠå¼€å‘å·¥å…·çš„é™åˆ¶ï¼Œåªèƒ½ä»¥ç®€å•çš„æ§åˆ¶å°æ¥æ¨¡æ‹Ÿç¨‹åºï¼Œä½†æ˜¯<strong>éº»é›€è™½å°äº”è„ä¿±å…¨</strong>ã€‚</p>
<p>å’Œä¸Šé¢è¡¨ç°çš„ä¸€æ ·ï¼Œæ§åˆ¶å°çš„ç¨‹åºåŒæ ·æ‹¥æœ‰ä¸€çº§èœå•ï¼ˆç™»å½•ä¹‹åçš„é€‰é¡¹ï¼‰å’ŒäºŒçº§èœå•ï¼ˆèŠå¤©ç•Œé¢ï¼‰</p>
<p>è€ƒè™‘åˆ°å¼€å‘çš„æ—¶é—´ï¼Œæœ¬ç¨‹åºç™»å½•ä¸éœ€è¦ç”¨æˆ·åä¸å¯†ç ï¼Œå¼€å¯ç¨‹åºåå³å¯è¿æ¥æœåŠ¡å™¨ï¼›ç”¨æˆ·èŠå¤©æ—¶æ ¹æ®IPä¸ç”µè„‘åæ¥æŸ¥æ‰¾èŠå¤©å¯¹è±¡ã€‚</p>
<p><strong>å®Œæˆæ­¤é¡¹ç›®éœ€è¦å¯¹å¤šçº¿ç¨‹æœ‰æ‰€äº†è§£ï¼ŒSocketçš„ç½‘ç»œçŸ¥è¯†ï¼Œå¯¹è±¡æµçš„IOï¼Œåºåˆ—åŒ–çŸ¥è¯†çš„åˆæ­¥äº†è§£ï¼ŒJAVAåŸºç¡€çŸ¥è¯†</strong></p>
<h2 id="æ­¥éª¤è®²è§£"><a href="#æ­¥éª¤è®²è§£" class="headerlink" title="æ­¥éª¤è®²è§£"></a>æ­¥éª¤è®²è§£</h2><p>å†™ç¨‹åºå‰è¦å…ˆæ„æ€ç”»å›¾ç¡®è®¤æ–¹æ¡ˆä¹‹åå†è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘å…ˆæŠŠåæœŸçš„ç”»é¢ä½¿ç”¨ç”»å›¾è½¯ä»¶ç¡®è®¤ä¸‹æ¥ã€‚</p>
<h3 id="view"><a href="#view" class="headerlink" title="view"></a>view</h3><p><strong>ä¸€çº§èœå•</strong>å¦‚ä¸‹ï¼š</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823172114325.png" alt="image-20210823172114325"></p>
<p><strong>äºŒçº§èœå•</strong>ï¼š</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823172204669.png" alt="image-20210823172204669"></p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å±€åŸŸç½‘é€šä¿¡æ˜¯å…¸å‹çš„Client - Serveræƒ…å½¢, æˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç«¯å§‹ç»ˆä¿æŒç€å¤šä¸ªSocketçº¿ç¨‹ï¼Œ è€ŒClientä¹Ÿèƒ½å¤Ÿæ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼šä¸€ä¸ªç”¨äºèŠå¤©ï¼Œä¸€ä¸ªç”¨äºä¼ è¾“æ–‡ä»¶(ç”±äºæœ€è¿‘æ—¶é—´æœ‰é™ï¼Œå°šæœªå¢æ·»æ­¤åŠŸèƒ½ï¼Œä¸è¿‡å’Œä¸Šé¢æœåŠ¡å™¨æ“ä½œæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä¹‹åè®²è§£å¯èƒ½æœ‰è®²åˆ°ï¼Œä½†ç¨‹åºä¸­å¹¶æœªæ·»åŠ æ­¤åŠŸèƒ½)ã€‚</p>
<p>æˆ‘ä»¬çš„å®¢æˆ·ç«¯æ¥æ”¶ä¿¡æ¯æ˜¯ä¸€ä¸ª<strong>åŠ¨æ€</strong>çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨èŠå¤©é¢æ¿æ‰“å¼€æ—¶æ¥æ”¶ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åœ¨åˆšç™»é™†æ—¶æ¥æ”¶ä¿¡æ¯ï¼Œå› æ­¤è¿™ä¹Ÿéœ€è¦çº¿ç¨‹çš„çŸ¥è¯†ï¼›</p>
<p><strong>è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿˜æ˜¯ç›´æ¥ç”»å¼ å›¾æ˜ç™½</strong>ï¼š</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/20210823_215520815_iOS-1629765663285.png" alt="20210823_215520815_iOS"></p>
<p>Tä»£è¡¨çº¿ç¨‹ï¼ŒSocketä»£è¡¨ä¼ è¾“ä¿¡æ¯çš„é€šé“ï¼Œå½“æˆ‘ä»¬æƒ³è¦æŠŠä¸€æ®µæ•°æ®å‘ç»™å…¶ä»–äººæ—¶ï¼Œæˆ‘ä»¬å…¶å®æ˜¯å…ˆæŠŠæ•°æ®å‘ç»™æœåŠ¡å™¨ï¼Œä»¥æœåŠ¡å™¨ä¸ºä¸­è½¬å†å°†å†…å®¹å‘ç»™æ¥æ”¶è€…ï¼ˆçœ‹ä¸Šé¢çš„ä¿¡æ¯æ•°æ®ä¼ è¾“ç®­å¤´ï¼‰</p>
<h3 id="ç±»å¯¹è±¡"><a href="#ç±»å¯¹è±¡" class="headerlink" title="ç±»å¯¹è±¡"></a>ç±»å¯¹è±¡</h3><p>çœ‹ç€ä¸Šé¢çš„å›¾æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä¹‹åå¯èƒ½è¦åˆ›å»ºçš„classç±»å¯¹è±¡</p>
<p><strong>å®¢æˆ·ç«¯</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823212629703.png" alt="image-20210823212629703"></p>
<p><strong>æœåŠ¡ç«¯</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823214129039.png" alt="image-20210823214129039"></p>
<h2 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h2><p>ç¡®å®šå®Œä¹‹å‰çš„ä¸€äº›ä¸œè¥¿ä¹‹åï¼Œè¦å¼€å§‹ç¼–ç </p>
<p>æˆ‘å°†ç¨‹åºåˆ†ä¸º<strong>å®¢æˆ·ç«¯</strong>ä¸<strong>æœåŠ¡ç«¯</strong>ä¸¤éƒ¨åˆ†</p>
<h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><p>å½“ç”¨æˆ·æ‰“å¼€ç¨‹åºæ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªUserç±»ï¼Œæ­¤ç±»å‚¨å­˜äº†ç”¨æˆ·çš„IPåœ°å€å’Œç”¨æˆ·ç”µè„‘çš„Local Host Name, è¿™æ ·ä¼šæ–¹ä¾¿ä¹‹åä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Modle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.NetworkInterface;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketException;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">String</span> <span class="variable">UID</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> String Uname=<span class="literal">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * è€ƒè™‘åˆ°æˆ‘çš„ç”µè„‘å®‰è£…äº†è™šæ‹Ÿæœºï¼Œéœ€è¦æ£€æŸ¥å…·ä½“çš„IPï¼Œæ‰€ä»¥ä¸‹é¢çš„ç¨‹åºç”¨äºæ‰«ææœ¬æœºæ‰€æœ‰ç½‘ç»œç«¯å£ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©ç›¸åº”çš„ip</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Uname = InetAddress.getLocalHost().getHostName(); <span class="comment">//è·å–ä¸»æœºå</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (UnknownHostException e1) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e1.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		Enumeration&lt;NetworkInterface&gt; i =<span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			i = NetworkInterface.getNetworkInterfaces();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SocketException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		  ArrayList&lt;String&gt; IPlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">		  <span class="keyword">while</span>(i.hasMoreElements())</span><br><span class="line">		    &#123;</span><br><span class="line">		        <span class="type">NetworkInterface</span> <span class="variable">n</span> <span class="operator">=</span> i.nextElement();</span><br><span class="line">		        Enumeration&lt;InetAddress&gt; ea = n.getInetAddresses();</span><br><span class="line">		        </span><br><span class="line">		        <span class="keyword">while</span>(ea.hasMoreElements())</span><br><span class="line">		        &#123;	</span><br><span class="line">		            <span class="type">InetAddress</span> <span class="variable">a</span> <span class="operator">=</span> ea.nextElement();</span><br><span class="line">		            <span class="keyword">if</span>(a.getHostAddress().toCharArray()[<span class="number">3</span>] ==<span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">		            	IPlist.add(a.getHostAddress());</span><br><span class="line">		            &#125;</span><br><span class="line">		        &#125;</span><br><span class="line">		    &#125;</span><br><span class="line"><span class="comment">//é€‰å–å¯¹åº”çš„IP(æ ¹æ®è‡ªå·±çš„è¦æ±‚)</span></span><br><span class="line">		  <span class="keyword">for</span>(String ip:IPlist) &#123;</span><br><span class="line">			  <span class="keyword">if</span>(ip.indexOf(<span class="string">&quot;137.&quot;</span>)!=-<span class="number">1</span>) &#123;</span><br><span class="line">				  UID = ip;</span><br><span class="line">				  <span class="keyword">break</span>;</span><br><span class="line">			  &#125;</span><br><span class="line">			  <span class="keyword">if</span>(ip.indexOf(<span class="string">&quot;192.&quot;</span>)!=-<span class="number">1</span>) &#123;</span><br><span class="line">				  UID = ip;</span><br><span class="line">			  &#125;</span><br><span class="line">		  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//è·å–ID</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getUID</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> UID;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//è·å–ä¸»æœºå</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getUname</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Uname;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="MessageType"><a href="#MessageType" class="headerlink" title="MessageType"></a>MessageType</h4><p>è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­çš„å˜é‡éƒ½æ˜¯public static final, æ‰€ä»¥å¯ä»¥ç”¨æ¥å‚¨å­˜ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚æ¯ä¸ªæ•°å­—éƒ½æœ‰è‡ªå·±çš„å«ä¹‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Modle;</span><br><span class="line"><span class="comment">//æ–¹ä¾¿åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageType</span> &#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">allUsers</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">chat</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">sendFile</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">getFile</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">connect</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">exit</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h4><p>Messageæ˜¯ç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’ä¿¡æ¯çš„è½½ä½“ï¼Œé‡Œé¢åŒ…æ‹¬äº†è·å–åœ¨çº¿ç”¨æˆ·çš„å®¹å™¨[ArrayList], å‘Šè¯‰è®¡ç®—æœºæˆ‘ä»¬è¦åšä»€ä¹ˆçš„MessageType(MT), æœ‰Senderå’ŒReceiverï¼Œè¿˜æœ‰æœ€é‡è¦çš„Wordsï¼Œè¿™äº›ä¿¡æ¯éƒ½æ‰¿è½½åœ¨ä¸€ä¸ªMessageå¯¹è±¡ä¸­ï¼Œæœ€åè¦é€šè¿‡Socketçš„outputStreamå†™ç»™æœåŠ¡å™¨ï¼›ä¸ºä¿è¯Messageç±»èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ä¸­æ­£å¸¸è¢«è¯»å–ï¼Œæˆ‘ä»¬é‡‡ç”¨åºåˆ—åŒ–æ“ä½œï¼Œç»§æ‰¿Serializableæ¥å£ï¼Œå‚¨å­˜äº†SerialVersionUID.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Modle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String words=<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="variable">MT</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">	<span class="keyword">private</span> String sender=<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">private</span> String receiver=<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">private</span> ArrayList&lt;String&gt; users =<span class="literal">null</span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> users;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsers</span><span class="params">(ArrayList&lt;String&gt; users)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.users = users;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getSender</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> sender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSender</span><span class="params">(String sender)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.sender = sender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getReceiver</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> receiver;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setReceiver</span><span class="params">(String receiver)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.receiver = receiver;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getWords</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> words;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWords</span><span class="params">(String words)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.words = words;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMT</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> MT;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMT</span><span class="params">(<span class="type">int</span> mT)</span> &#123;</span><br><span class="line">		MT = mT;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="UserThread"><a href="#UserThread" class="headerlink" title="UserThread"></a>UserThread</h4><p>ç”¨æˆ·çš„çº¿ç¨‹ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯çš„å¼€å¯å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œmainå‡½æ•°æ˜¯ä¸»è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¸ºäº†è®©ç”¨æˆ·å¼€å¯ç¨‹åºå°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä»»ä½•æ—¶å€™éƒ½èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ğŸ˜‰ï¼Œäºæ˜¯å¯ç”¨å¤šçº¿ç¨‹æœåŠ¡ï¼ŒUserThreadå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Modle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨æˆ·çº¿ç¨‹ç±»ï¼Œç”¨äºæ¥æ”¶æœåŠ¡å™¨å‘é€è¿‡æ¥çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;<span class="comment">//æ­¤çº¿ç¨‹ç»§æ‰¿Threadç±»</span></span><br><span class="line">	<span class="keyword">private</span> Socket UserSocket=<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; allUsers=<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; ChatContent=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//allUsers å’Œ ChatContentéƒ½ä½¿ç”¨é™æ€å˜é‡çš„åŸå› æ˜¯ï¼šä¸€æ—¦ç¨‹åºå¼€å¯ï¼Œä»–ä»¬å°±å¯ä»¥ä¸€ç›´å…¨å±€è®¿é—®	</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">UserThread</span><span class="params">(Socket us)</span> &#123;</span><br><span class="line">		UserSocket = us;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Socket <span class="title function_">getUserSocket</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> UserSocket;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> allUsers;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title function_">getContent</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ChatContent;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡å†™Runæ–¹æ³•</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨å¾ªç¯è¡¨ç¤ºä¸€ç›´åœ¨è¿è¡Œï¼Œä¸ç„¶è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€éåå°±ä¸æ‰§è¡Œäº†</span></span><br><span class="line">		<span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">			ObjectInputStream ois;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				ois = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(UserSocket.getInputStream());</span><br><span class="line">				<span class="type">Message</span> <span class="variable">mms</span> <span class="operator">=</span> (Message)ois.readObject(); <span class="comment">//å¦‚æœæœåŠ¡å™¨æ²¡æœ‰å‘é€æ•°æ®ï¼Œé€šé“ä¼šä¸€ç›´é˜»å¡</span></span><br><span class="line">				<span class="comment">//æœåŠ¡å™¨å‘ç”¨æˆ·å‘é€çš„messageæ˜¯allUser</span></span><br><span class="line">				<span class="keyword">if</span>(mms.getMT() == MessageType.allUsers) &#123;</span><br><span class="line">					UserThread.allUsers = mms.getUsers();</span><br><span class="line">				<span class="comment">//å‘é€ä½†æ˜¯ä¿¡æ¯					</span></span><br><span class="line">				&#125;<span class="keyword">else</span> <span class="keyword">if</span>(mms.getMT() == MessageType.chat) &#123;</span><br><span class="line">					ChatContent.add(mms.getSender()+<span class="string">&quot; å¯¹ &quot;</span>+mms.getReceiver()+<span class="string">&quot; è¯´:\n &quot;</span>+mms.getWords());</span><br><span class="line">					System.out.println(<span class="string">&quot;è¿‡å¾€ä¿¡æ¯ï¼š&quot;</span>);</span><br><span class="line">					<span class="comment">//æ˜¾ç¤ºè¿‡å¾€æ¶ˆæ¯ä¿¡æ¯</span></span><br><span class="line">					<span class="keyword">for</span>(String chatContent:ChatContent)</span><br><span class="line">						System.out.println(chatContent);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="UserConnectService"><a href="#UserConnectService" class="headerlink" title="UserConnectService"></a>UserConnectService</h4><p>å¼€å§‹ç”¨æˆ·éœ€è¦å°†ç”µè„‘è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œä»¥æ­¤æ¥æ„å»ºSocketé€šä¿¡,å¹¶å¼€å¯çº¿ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ConnectToServer</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//137.112.237.25æ˜¯æœåŠ¡å™¨æ‰€åœ¨IPï¼Œ10086æ˜¯ç›‘å¬ç«¯å£</span></span><br><span class="line">		UserSocket = <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;137.112.237.25&quot;</span>, <span class="number">10086</span>);</span><br><span class="line">		<span class="comment">//åˆ›å»ºMessageå¯¹è±¡ï¼Œåœ¨è¿™ä¸ªè½½ä½“ä¸­å†™å…¥æˆ‘ä»¬çš„ä¿¡æ¯</span></span><br><span class="line">           <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">		message.setMT(MessageType.connect);</span><br><span class="line">		message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//è¾“å‡ºæµå°†messageå¯¹è±¡å†™ç»™æœåŠ¡å™¨ç«¯</span></span><br><span class="line">		<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(UserSocket.getOutputStream());</span><br><span class="line">		output.writeObject(message);</span><br><span class="line">		</span><br><span class="line">           <span class="comment">//æˆ‘ä»¬æŠŠè¿™ä¸ªå»ºç«‹è¿æ¥çš„Socketæ”¾å…¥åˆ°çº¿ç¨‹ï¼ŒæŒç»­ç›‘å¬æœåŠ¡å™¨å‘é€çš„ä¿¡æ¯</span></span><br><span class="line">		userThread = <span class="keyword">new</span> <span class="title class_">UserThread</span>(UserSocket);</span><br><span class="line">		userThread.start();<span class="comment">//åˆ«å¿˜äº†å¼€å¯çº¿ç¨‹</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è·å–åœ¨çº¿ç”¨æˆ·çš„IPå’Œåç§°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–åœ¨çº¿ç”¨æˆ·IP</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">GetAllIP</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//å»ºç«‹Messageå¯¹è±¡</span></span><br><span class="line">		<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">		message.setMT(MessageType.allUsers);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªæ˜¯ä¸ºäº†æ–¹ä¾¿æœåŠ¡å™¨åˆ¤æ–­IPï¼Œè¿™æ ·å°±ä¸ä¼šå‘é€æœ¬æœºçš„IPäº†</span></span><br><span class="line">		message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å‘é€</span></span><br><span class="line">			<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(userThread.getUserSocket().getOutputStream());</span><br><span class="line">			output.writeObject(message);</span><br><span class="line">			<span class="comment">//ç­‰å¾…æ¥æ”¶IPï¼Œç½‘ç»œæœ‰å»¶è¿Ÿ</span></span><br><span class="line">			<span class="keyword">if</span>(userThread.getAllUsers() == <span class="literal">null</span>) &#123;</span><br><span class="line">				Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="comment">//ç­‰ä¸€ä¼šä¹‹åè¿˜æ²¡æœ‰å°±è¿”å›ç©º</span></span><br><span class="line">			<span class="keyword">if</span>(userThread.getAllUsers() == <span class="literal">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">			<span class="keyword">return</span> userThread.getAllUsers();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<p>å‘æŒ‡å®šç”¨æˆ·ä¼ è¾“ä¿¡æ¯</p>
<p>è¿™é‡Œæˆ‘ä»¬è¦è¾“å…¥å¯¹åº”çš„IPåœ°å€å’Œä¿¡æ¯ï¼Œç”±äºæ˜¯Serviceï¼Œæˆ‘åšæˆäº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ–¹ä¾¿ä¹‹ååœ¨Menusï¼ˆViewï¼‰ä¸­è°ƒç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//å‘æŒ‡å®šç”¨æˆ·ä¼ è¾“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">SendChatContent</span><span class="params">(String receiver, String words)</span>&#123;</span><br><span class="line">       <span class="comment">//åŒä¸Š</span></span><br><span class="line">	<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">	message.setMT(MessageType.chat);</span><br><span class="line">	message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">	message.setReceiver(receiver);</span><br><span class="line">       <span class="comment">//æˆ‘ä»¬è¦åŠ å…¥å‘é€çš„æ—¶é—´</span></span><br><span class="line">	<span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">	message.setWords(words+<span class="string">&quot;\t&quot;</span>+date.toString());</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(userThread.getUserSocket().getOutputStream());</span><br><span class="line">		output.writeObject(message);</span><br><span class="line">		</span><br><span class="line">           <span class="type">String</span> <span class="variable">words1</span> <span class="operator">=</span> message.getSender()+<span class="string">&quot; å¯¹ &quot;</span>+message.getReceiver()+<span class="string">&quot; è¯´:\n &quot;</span>+message.getWords();</span><br><span class="line">		</span><br><span class="line">           <span class="comment">//userThread.getContent().add(words1);</span></span><br><span class="line">           <span class="comment">//è¿”å›å‘é€çš„å†…å®¹ï¼Œåˆ°æ—¶å€™åœ¨Viewæ§åˆ¶å°ä¸­æ‰“å°å‡ºæ¥</span></span><br><span class="line">		<span class="keyword">return</span> words1;</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;è¿æ¥è¶…æ—¶ï¼Œä¿¡æ¯æœªå‘é€&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>é€€å‡ºæœåŠ¡</p>
<p>é€€å‡ºä¹‹å‰æˆ‘ä»¬è¦å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬è¦é€€å‡ºäº†ï¼Œè®©æœåŠ¡å™¨åœ¨æœåŠ¡å™¨ä¸­åˆ é™¤æˆ‘ä»¬çš„çº¿ç¨‹ï¼Œå…³é—­æˆ‘ä»¬çš„Socketé€šé“ï¼Œæˆ‘ä»¬ç„¶åç›´æ¥é€€å‡ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€€å‡ºæœåŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Exit</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//å‘æœåŠ¡å™¨å‘é€é€€å‡ºæŒ‡ä»¤</span></span><br><span class="line">	<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">	message.setMT(MessageType.exit);</span><br><span class="line">	message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(userThread.getUserSocket().getOutputStream());</span><br><span class="line">		output.writeObject(message);</span><br><span class="line">		System.exit(<span class="number">0</span>);<span class="comment">//ç³»ç»Ÿé€€å‡º</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>UserConnectService å…¨éƒ¨ä»£ç ï¼Œéƒ½æ˜¯public static method</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.peter.Modle.Message;</span><br><span class="line"><span class="keyword">import</span> com.peter.Modle.MessageType;</span><br><span class="line"><span class="keyword">import</span> com.peter.Modle.User;</span><br><span class="line"><span class="keyword">import</span> com.peter.Modle.UserThread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConnectService</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Socket</span> <span class="variable">UserSocket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> User user= <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> UserThread userThread;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ConnectToServer</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			UserSocket = <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;137.112.237.25&quot;</span>, <span class="number">10086</span>);</span><br><span class="line">			<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">			message.setMT(MessageType.connect);</span><br><span class="line">			message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(UserSocket.getOutputStream());</span><br><span class="line">			output.writeObject(message);</span><br><span class="line">			</span><br><span class="line">			userThread = <span class="keyword">new</span> <span class="title class_">UserThread</span>(UserSocket);</span><br><span class="line">			userThread.start();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//è·å–åœ¨çº¿ç”¨æˆ·IP</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">GetAllIP</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">		message.setMT(MessageType.allUsers);</span><br><span class="line">		message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(userThread.getUserSocket().getOutputStream());</span><br><span class="line">			output.writeObject(message);</span><br><span class="line">			<span class="comment">//ç­‰å¾…å‘é€IP</span></span><br><span class="line">			<span class="keyword">if</span>(userThread.getAllUsers() == <span class="literal">null</span>) &#123;</span><br><span class="line">				Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(userThread.getAllUsers() == <span class="literal">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">			<span class="keyword">return</span> userThread.getAllUsers();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//å‘æŒ‡å®šç”¨æˆ·ä¼ è¾“ä¿¡æ¯</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">SendChatContent</span><span class="params">(String receiver, String words)</span>&#123;</span><br><span class="line">		<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">		message.setMT(MessageType.chat);</span><br><span class="line">		message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">		message.setReceiver(receiver);</span><br><span class="line">		<span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">		message.setWords(words+<span class="string">&quot;\t&quot;</span>+date.toString());</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(userThread.getUserSocket().getOutputStream());</span><br><span class="line">			output.writeObject(message);</span><br><span class="line">			<span class="type">String</span> <span class="variable">words1</span> <span class="operator">=</span> message.getSender()+<span class="string">&quot; å¯¹ &quot;</span>+message.getReceiver()+<span class="string">&quot; è¯´:\n &quot;</span>+message.getWords();</span><br><span class="line">			userThread.getContent().add(words1);</span><br><span class="line">			<span class="keyword">return</span> words1;</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;è¿æ¥è¶…æ—¶ï¼Œä¿¡æ¯æœªå‘é€&quot;</span>;</span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//é€€å‡ºæœåŠ¡</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Exit</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//å‘æœåŠ¡å™¨å‘é€é€€å‡ºæŒ‡ä»¤</span></span><br><span class="line">		<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">		message.setMT(MessageType.exit);</span><br><span class="line">		message.setSender(user.getUname()+<span class="string">&quot;:&quot;</span>+user.getUID());</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(userThread.getUserSocket().getOutputStream());</span><br><span class="line">			output.writeObject(message);</span><br><span class="line">			System.exit(<span class="number">0</span>);<span class="comment">//ç³»ç»Ÿé€€å‡º</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Menus"><a href="#Menus" class="headerlink" title="Menus"></a>Menus</h4><p>menusæ˜¯èœå•ï¼Œä¸€çº§èœå•ï¼ŒäºŒçº§èœå•çš„æ˜¾ç¤ºéƒ½åœ¨è¿™é‡Œï¼Œå¯ä»¥è¯´æ˜¯æ˜¾ç¤ºå±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.peter.Service.UserConnectService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menus</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ°æ—¶å€™æµ‹è¯•ç±»è°ƒç”¨Startæ–¹æ³•å°±å¥½</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Start</span><span class="params">()</span> &#123;</span><br><span class="line">		FirstMenu();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//æ˜¾ç¤ºä¸€çº§èœå•</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">FirstMenu</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">open</span> <span class="operator">=</span><span class="literal">true</span>;</span><br><span class="line">		<span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">		UserConnectService.ConnectToServer();</span><br><span class="line">        <span class="comment">//ä¸€çº§èœå•ä½¿ç”¨å¾ªç¯ï¼Œè‹¥é€€å‡ºåˆ™å¾ªç¯ç»ˆæ­¢</span></span><br><span class="line">		<span class="keyword">while</span>(open) &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;\n\n====èŠå¤©ä¸€çº§èœå•====&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;\t1. èŠå¤©é¢ç‰ˆ&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;\t4.é€€å‡º&quot;</span>);</span><br><span class="line">			System.out.print(<span class="string">&quot;   é€‰æ‹©ï¼š&quot;</span>);</span><br><span class="line">			input = <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">			<span class="keyword">switch</span> (input.next()) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">				Chatting(input);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">				</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;4&quot;</span>:</span><br><span class="line">				UserConnectService.Exit();</span><br><span class="line">				open = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		input.close();</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//äºŒçº§èœå•</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Chatting</span><span class="params">(Scanner input)</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">open</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//åŒæ ·ä½¿ç”¨å¾ªç¯æ§åˆ¶ï¼Œæ–¹ä¾¿æŒç»­äº¤æµ</span></span><br><span class="line">		<span class="keyword">while</span>(open) &#123;</span><br><span class="line">			</span><br><span class="line">			System.out.println(<span class="string">&quot;\n\n====èŠå¤©äºŒçº§èœå•(èŠå¤©é¢æ¿)====&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;åœ¨çº¿è”ç³»äººå¦‚ä¸‹ï¼š&quot;</span>);</span><br><span class="line">            <span class="comment">//å†…å®¹çš„è·å–éƒ½æ˜¯æ ¹æ®ä¹‹å‰çš„UserConnectServiceå·¥å…·ç±»æ¥è·å¾—</span></span><br><span class="line">			ArrayList&lt;String&gt; tmpSet = UserConnectService.GetAllIP();</span><br><span class="line">			</span><br><span class="line">            <span class="comment">//è‹¥æ— åœ¨çº¿ç”¨æˆ·ï¼Œç›´æ¥ä¸è®©ç”¨æˆ·è¿›è¡Œäº¤æµ</span></span><br><span class="line">			<span class="keyword">if</span>(tmpSet == <span class="literal">null</span>) &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;æš‚æ—¶æ— ä¸Šçº¿ç”¨æˆ·&quot;</span>);</span><br><span class="line">				open = <span class="literal">false</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//æœ‰åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæ‰“å°åœ¨çº¿ç”¨æˆ·</span></span><br><span class="line">				<span class="keyword">for</span>(String tmp: tmpSet) &#123;</span><br><span class="line">					System.out.println(tmp);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				System.out.println(<span class="string">&quot;\n\t1.é€‰æ‹©äººèŠå¤©&quot;</span>);</span><br><span class="line">				System.out.println(<span class="string">&quot;\t2.é€€å‡º&quot;</span>);</span><br><span class="line">				System.out.print(<span class="string">&quot;ä½ çš„é€‰æ‹©ï¼š&quot;</span>);</span><br><span class="line">				<span class="type">String</span> <span class="variable">choice</span> <span class="operator">=</span> input.next();</span><br><span class="line">				input.reset();<span class="comment">//ä¸ºé¿å…scannerçš„é—®é¢˜ï¼Œä½¿ç”¨reseté‡å¯æ–¹æ³•</span></span><br><span class="line">				</span><br><span class="line">				<span class="keyword">switch</span> (choice) &#123;</span><br><span class="line">				<span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">					</span><br><span class="line">					System.out.print(<span class="string">&quot;èŠå¤©å¯¹è±¡çš„IPï¼š&quot;</span>);</span><br><span class="line">					<span class="type">String</span> <span class="variable">receiver</span> <span class="operator">=</span> input.next();</span><br><span class="line">					input.reset();</span><br><span class="line">					System.out.print(<span class="string">&quot;æƒ³è¯´çš„è¯ï¼š&quot;</span>);</span><br><span class="line">					input.nextLine();<span class="comment">//åƒæ‰ä¸€ä¸ª\n</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">words</span> <span class="operator">=</span> input.nextLine();</span><br><span class="line">					input.reset();</span><br><span class="line">                    <span class="comment">//æ‰“å°åˆšæ‰å‘é€çš„ä¿¡æ¯</span></span><br><span class="line">					System.out.println(UserConnectService.SendChatContent(receiver, words));</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">					</span><br><span class="line">				<span class="keyword">case</span> <span class="string">&quot;2&quot;</span>:</span><br><span class="line">					open = <span class="literal">false</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">default</span>:</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><h4 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h4><p>æœåŠ¡å™¨ç»ˆç«¯ç±»ï¼Œç”¨äºæ§åˆ¶æœåŠ¡å™¨çš„å¼€å¯ï¼Œéœ€è¦å¼€å¯æœåŠ¡å™¨ç«¯å…ˆå®ä¾‹åŒ–ä¸€ä¸ªTerminalå¯¹è±¡ï¼Œä¼ å…¥æœåŠ¡å™¨ç›‘å¬ç«¯å£</p>
<p>æœåŠ¡å™¨ç«¯æ˜¯ä¸€ç›´è¿›è¡Œwhileå¾ªç¯ï¼Œç”¨äºæŒç»­ç›‘å¬æ˜¯å¦æœ‰æ–°çš„è¿æ¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Modle;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * æœåŠ¡å™¨ç±»</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Terminal</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> ServerSocket listener; <span class="comment">//ç”¨äºç›‘å¬ç«¯å£</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Terminal</span><span class="params">(<span class="type">int</span> port)</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;æœåŠ¡å™¨Start&quot;</span>);</span><br><span class="line">			listener = <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port); <span class="comment">//ç¡®è®¤ç«¯å£</span></span><br><span class="line">			Socket accept; <span class="comment">//è¿æ¥çš„Socketé€šé“</span></span><br><span class="line">			<span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">				accept = listener.accept(); <span class="comment">//å»ºç«‹é€šé“è¿æ¥</span></span><br><span class="line">				<span class="comment">//è·å–è¿æ¥åå°†æ­¤socketé€šé“æ”¾å…¥çº¿ç¨‹å’Œçº¿ç¨‹æ± ä¸­è¿›è¡Œç®¡ç†</span></span><br><span class="line">				<span class="type">ObjectInputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(accept.getInputStream());</span><br><span class="line">				<span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> (Message)input.readObject();<span class="comment">//å¼€å§‹æ—¶åˆ¤æ–­æ˜¯å¦æ˜¯åœ¨ç™»å½•</span></span><br><span class="line">				<span class="keyword">if</span>(message.getMT() == MessageType.connect) &#123;</span><br><span class="line">					<span class="type">ServerThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerThread</span>(accept, message.getSender());</span><br><span class="line">					System.out.println(message.getSender()+<span class="string">&quot;ä¸Šçº¿äº†&quot;</span>);</span><br><span class="line">					thread.start();<span class="comment">//å¼€å¯çº¿ç¨‹</span></span><br><span class="line">					ManageClientThreads.addThread(message.getSender(), thread);<span class="comment">//åŠ å…¥åˆ°çº¿ç¨‹æ± ä¸­</span></span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			 </span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="ServerThread"><a href="#ServerThread" class="headerlink" title="ServerThread"></a>ServerThread</h4><p>æœåŠ¡å™¨çš„çº¿ç¨‹ç±»ï¼Œå’Œå®¢æˆ·ç«¯çš„çº¿ç¨‹ç±»ä¸€æ ·ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Modle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.peter.Service.ShowOnline;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Socket socket;</span><br><span class="line">	<span class="keyword">private</span> String UID;</span><br><span class="line">	<span class="comment">//åœ¨æœåŠ¡å™¨ç«¯ç®¡ç†çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰å¯¹åº”çš„UID</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ServerThread</span><span class="params">(Socket s, String id)</span> &#123;</span><br><span class="line">		socket = s;</span><br><span class="line">		UID =id;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getUID</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> UID;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Socket <span class="title function_">getSocket</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> socket;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//ä½¿ç”¨å¾ªç¯ï¼Œä½¿æ­¤socketçº¿ç¨‹ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€ï¼Œè‹¥æ²¡æœ‰å†…å®¹å‘è¿‡æ¥ï¼Œåˆ™é˜»å¡åœ¨æ­¤</span></span><br><span class="line">		<span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">			Message message;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="type">ObjectInputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">				message = (Message)input.readObject();</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//åˆ¤æ–­å‘é€è¿‡æ¥çš„å†…å®¹</span></span><br><span class="line">				<span class="keyword">if</span>(message.getMT()==MessageType.allUsers) &#123; <span class="comment">//è¯·æ±‚æ‰€æœ‰åœ¨çº¿ç”¨æˆ·</span></span><br><span class="line">					System.out.println(UID+<span class="string">&quot;å‘æœåŠ¡å™¨è¯·æ±‚åœ¨çº¿ç”¨æˆ·&quot;</span>);</span><br><span class="line">					message.setUsers(ShowOnline.getAllIP(UID));</span><br><span class="line">					<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">					output.writeObject(message);</span><br><span class="line">					</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(message.getMT() == MessageType.chat) &#123;<span class="comment">//Aç”¨æˆ·è¯·æ±‚ä¸Bç”¨æˆ·é€šä¿¡</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">receiver</span> <span class="operator">=</span> message.getReceiver();</span><br><span class="line">					<span class="type">ServerThread</span> <span class="variable">receiverThread</span> <span class="operator">=</span> ManageClientThreads.getThread(receiver);<span class="comment">//æˆ‘ä»¬å…ˆæ ¹æ®Bç”¨æˆ·çš„åç§°æ‰¾åˆ°Bç”¨æˆ·çš„çº¿ç¨‹</span></span><br><span class="line">					System.out.println(message.getSender()+<span class="string">&quot;å‘&quot;</span>+receiver+<span class="string">&quot;å‘é€:\n&quot;</span>+message.getWords());</span><br><span class="line">                    <span class="comment">//åˆ¤æ–­ä¸€ä¸‹æ­¤ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">					<span class="keyword">if</span>(receiverThread!=<span class="literal">null</span>) &#123;</span><br><span class="line">						</span><br><span class="line">						<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(receiverThread.getSocket().getOutputStream());</span><br><span class="line">						output.writeObject(message);</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="comment">//è‹¥ä¸å­˜åœ¨ï¼Œè¿™ä¸ªæ€ä¹ˆå¤„ç†è¿˜æ²¡å†™</span></span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(message.getMT()==MessageType.exit) &#123; <span class="comment">//è¯·æ±‚é€€å‡º</span></span><br><span class="line">					<span class="comment">//é€€å‡ºæ—¶ä»çº¿ç¨‹æ± ä¸­åˆ é™¤ï¼Œå°†socketé€šé“å…³é—­</span></span><br><span class="line">					ManageClientThreads.delThread(UID);</span><br><span class="line">					socket.close();</span><br><span class="line">					System.out.println(message.getSender()+<span class="string">&quot;é€€å‡º&quot;</span>);</span><br><span class="line">					<span class="keyword">break</span>; <span class="comment">//ç»ˆæ­¢å¾ªç¯</span></span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="ManageClientThreads"><a href="#ManageClientThreads" class="headerlink" title="ManageClientThreads"></a>ManageClientThreads</h4><p>çº¿ç¨‹æ± ï¼Œç®¡ç†çº¿ç¨‹ï¼Œå¯¹çº¿ç¨‹è¿›è¡Œå¢åˆ æŸ¥</p>
<p>æ¯ä¸ªçº¿ç¨‹è¢«å‚¨å­˜åœ¨HashMapä¸­ï¼Œä»¥ç”¨æˆ·IDä¸ºkey, Threadä¸ºvalueï¼Œæ–¹ä¾¿æŸ¥è¯¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Modle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="comment">//ç®¡ç†çº¿ç¨‹çš„ç±»ï¼Œçº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManageClientThreads</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String, ServerThread&gt; threads = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">	<span class="comment">//UIDä¸ºçº¿ç¨‹Keyï¼Œsocketä¸ºvalue</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addThread</span><span class="params">(String UID, ServerThread s )</span> &#123;</span><br><span class="line">		threads.put(UID, s);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//åˆ é™¤çº¿ç¨‹</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">delThread</span><span class="params">(String UID)</span> &#123;</span><br><span class="line">		threads.remove(UID);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//è·å–å¯¹åº”çº¿ç¨‹</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ServerThread <span class="title function_">getThread</span><span class="params">(String UID)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span>(String id:threads.keySet()) &#123;</span><br><span class="line">			<span class="keyword">if</span>(KMP(id,UID,MatchMap(UID))!=-<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> threads.get(id);</span><br><span class="line">			&#125;</span><br><span class="line">				</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//ç”±äºç”¨æˆ·å­˜å‚¨çš„æ˜¯ç”¨æˆ·å+IPï¼Œè€Œå½“ç”¨æˆ·è¦ä¸å¦å¤–ä¸€ä¸ªç”¨æˆ·é€šä¿¡æ—¶è¾“å…¥çš„æ˜¯IPåœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦åšå­—ç¬¦ä¸²åŒ¹é…ä»¥æ‰¾åˆ°ç¬¦åˆçš„å­—ç¬¦ä¸²</span></span><br><span class="line">	<span class="comment">//ä½¿ç”¨KMPç®—æ³•åšå­—ç¬¦ä¸²åŒ¹é…</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] MatchMap(String dest) &#123;</span><br><span class="line">		<span class="type">int</span>[] map = <span class="keyword">new</span> <span class="title class_">int</span>[dest.length()];</span><br><span class="line">		map[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;dest.length();i++) &#123;</span><br><span class="line">			<span class="keyword">while</span>(j&gt;<span class="number">0</span>&amp;&amp;dest.charAt(i)!=dest.charAt(j))</span><br><span class="line">				j = map[j-<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span>(dest.charAt(i)==dest.charAt(j))</span><br><span class="line">				j++;</span><br><span class="line">			map[i] = j;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> map;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">KMP</span><span class="params">(String st1, String st2, <span class="type">int</span>[] map)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>, j=<span class="number">0</span>;i&lt;st1.length();i++) &#123;</span><br><span class="line">			<span class="keyword">while</span>(j&gt;<span class="number">0</span>&amp;&amp;st1.charAt(i)!=st2.charAt(j))</span><br><span class="line">				j = map[j-<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span>(st1.charAt(i)==st2.charAt(j))</span><br><span class="line">				j++;</span><br><span class="line">			<span class="keyword">if</span>(j&gt;=st2.length())</span><br><span class="line">				<span class="keyword">return</span> i-j+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="ShowOnline"><a href="#ShowOnline" class="headerlink" title="ShowOnline"></a>ShowOnline</h4><p>æ˜¾ç¤ºæ‰€æœ‰åœ¨çº¿ç”¨æˆ·ï¼Œå…¶å®å°±æ˜¯éå†çº¿ç¨‹æ± ï¼Œå°†æ¯ä¸ªKeyï¼ˆé™¤æŸ¥è¯¢æœ¬æœºçš„ç”¨æˆ·ä»¥å¤–ï¼‰è¿”å›ç»™æ­¤æŸ¥è¯¢ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peter.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.peter.Modle.ManageClientThreads;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowOnline</span> &#123;</span><br><span class="line">	<span class="comment">//æ ¹æ®çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè·å–æ‰€æœ‰UIDï¼Œå³åœ¨çº¿çš„ç”¨æˆ·</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">getAllIP</span><span class="params">(String UID)</span>&#123;</span><br><span class="line">		ArrayList&lt;String&gt; ips = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(ManageClientThreads.threads.keySet());</span><br><span class="line">		ips.remove(UID); <span class="comment">//åœ¨çº¿ç”¨æˆ·æŸ¥çœ‹æ—¶ï¼Œæ’é™¤ç”¨æˆ·è‡ªå·±</span></span><br><span class="line">		<span class="keyword">return</span> ips;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="MessageTypeå’ŒMessage"><a href="#MessageTypeå’ŒMessage" class="headerlink" title="MessageTypeå’ŒMessage"></a>MessageTypeå’ŒMessage</h4><p>MessageTypeå’ŒMessageä¸å®¢æˆ·ç«¯æ˜¯ä¸€æ ·çš„ï¼ŒMessageTypeå°±å¥½åƒæ˜¯ä¸€ä¸ªå¯†ç æœ¬ï¼Œä½¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨äº†è§£å½¼æ­¤è¦åšçš„äº‹ã€‚Messageå¿…é¡»è¦è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼ŒåŒæ—¶ä¿è¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„Messageå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·åœ¨ä»å®¢æˆ·ç«¯ä¼ è¾“Messageå¯¹è±¡åˆ°æœåŠ¡å™¨ç«¯æ—¶å°±ä¸ä¼šæŠ¥é”™ï¼Œï¼ˆClass Not Found Exceptionï¼‰</p>
<h2 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h2><p>æœ¬ç¨‹åºæœ‰è®¸å¤šå¯æ‹“å±•çš„åœ°æ–¹ï¼Œå¦‚è®©ç”¨æˆ·ä¹‹é—´å¯ä»¥ä¼ è¾“æ–‡ä»¶ï¼Œå½“ç”¨æˆ·è¾“å…¥é”™çš„IPæ—¶ï¼ŒæœåŠ¡å™¨ä¼šæç¤ºç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æœ‰é”™è¯¯ç­‰ç­‰ã€‚æ—¶é—´æœ‰é™ï¼Œéƒ¨åˆ†åŠŸèƒ½å°šæœªå®Œæˆï¼Œè¯·è°…è§£ã€‚</p>
<h2 id="å±•ç¤ºæ•ˆæœ"><a href="#å±•ç¤ºæ•ˆæœ" class="headerlink" title="å±•ç¤ºæ•ˆæœ"></a>å±•ç¤ºæ•ˆæœ</h2><p>æœ€ååªéœ€è¦å°†Menuså’ŒTerminalåˆ†åˆ«æ”¾åˆ°2ä¸ªæµ‹è¯•ç±»å½“ä¸­å°±å¥½ï¼Œè¿™æ ·å°±èƒ½å¼€å§‹è¿›è¡ŒæœåŠ¡å™¨ï¼Œ2å°å®¢æˆ·ç«¯é—´çš„é€šä¿¡äº†ã€‚ä¸‹é¢æ˜¯æˆæœå±•ç¤ºï¼š</p>
<p><strong>æœåŠ¡å™¨ç«¯</strong></p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221202447.png" alt="image-20210823221202447"></p>
<p><strong>å®¢æˆ·ç«¯</strong></p>
<p>ä¸€çº§èœå•</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221307532.png" alt="image-20210823221307532"></p>
<p>äºŒçº§èœå•</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221327569.png" alt="image-20210823221327569"></p>
<p>äºŒçº§èœå•æ”¶åˆ°å¦ä¸€ä¸ªç”¨æˆ·å‘æ¥çš„ä¿¡æ¯(ç”±äºæ˜¯æ§åˆ¶å°è¡¨ç¤ºä¿¡æ¯æ”¶å‘ä¸é€‰é¡¹é€‰æ‹©ï¼Œä¿¡æ¯æ˜¾ç¤ºä¼šæœ‰æ‰€å†²çª)</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221648652.png" alt="image-20210823221648652"></p>
<p>å®‰å…¨é€€å‡º</p>
<p><img src="/2021-08-23-JAVA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F/image-20210823221706176.png" alt="image-20210823221706176"></p>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><p>è¿™ä¸ªç¨‹åºè¯´å®è¯åšçš„æœ‰ç‚¹è‰ç‡ï¼Œå¾ˆå¤šåœ°æ–¹å…¶å®æœ‰Bugï¼Œè®¸å¤šè¾¹é™…æƒ…å†µç¡®å®æ²¡æœ‰è€ƒè™‘ï¼Œä½†è¿™ä¾ç„¶ä¸å¤±æ˜¯ä¸€ä¸ªå¥½çš„ç»ƒä¹ é¢˜ï¼Œç”¨æ¥ç»ƒä¹ å¤šçº¿ç¨‹ç®¡ç†ï¼ŒSocketé€šä¿¡ç­‰ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>HSPè€å¸ˆçš„è§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j54y1b7qv?p=30">https://www.bilibili.com/video/BV1j54y1b7qv?p=30</a></p>

    </div>
    
    
    
</div>
                        <footer id="footer">
    <div class="footer-wrap">
        <div>
            Â© 2020 - 2024 Yao Xiong
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Yao Xiong
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        


    </body>
</html>